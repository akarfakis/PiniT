@model PiniT.ViewModels.IndexRestaurantsVM

@{
    ViewBag.Title = "CustomerIndex";
}

<h2 class="h2">Are you hungry?</h2>
<div class="row">
    @foreach (var restaurant in Model.Restaurants)
    {
        <div class="col-md-3 card shadow border border-dark p-0 mx-1">
            <div class="card-header border-dark font-weight-bolder bg-secondary text-white text-center">
                <p class="m-0">@restaurant.CompanyName</p>
            </div>
            <div class="card-body bg-light border-dark text-center">
                <img class="card-img-top" src="https://comelite-arch.com/wp-content/uploads/2018/04/How-to-Create-a-Successful-Fine-Dining-Restaurant-0-256x256.jpg" alt="restaurant1">
                <hr class="m-1" />
                <p class="m-0">Info</p>
            </div>
            <div class="card-footer border-dark bg-light text-center">
                <div class="row">
                    @Html.ActionLink("Book Now!", "CustomerIndex", "Tables", new { id = restaurant.RestaurantId }, new { @class = "btn btn-danger col-12" })
                    @Html.ActionLink("Menu", "CustomerIndex", "Products", new { id = restaurant.RestaurantId }, new { @class = "btn btn-primary col-6" })

                    <button id="@restaurant.RestaurantId" data-company="@restaurant.CompanyName"class="btn btn-secondary col-6 restaurant-chat">Chat</button>
                </div>
            </div>
        </div>
    }
</div>

@section scripts {

    <script>
        $(document).ready(() => {
            let chat = $.connection.piniTHub;

            $('.restaurant-chat').click((e) => {

                $(`#chat`).html('');
                $('#chat').append(`
                    <div class="row">
                        <div class="card shadow-lg border border-success p-0 fixed-bottom alert alert-dismissible fade show ml-auto" role="alert" style="width:250px;">
                            <div class="card-header border-dark font-weight-bolder bg-success text-white text-center">
                                <div class="row">
                                    <p class="col-10 mb-0 mr-auto ml-2">${e.target.getAttribute('data-company')}</p>
                                    <button type="button" class="close col-2 ml-auto mr-1" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body bg-light border-success">
                                <div id="messages" class="overflow-auto" style="height:120px"></div>
                                 <br/>
                                <input id="message" class="form-control border border-success">
                                <button id="send" class="btn btn-success mt-1 mx-auto" type="button" aria-expanded="false">
                                    Send
                                </button>
            
        
                            </div>
                        </div>
                    </div>`);

                $.connection.hub.start().done(() => {

                    $('#send').click(() => {
                        chat.server.sendToUser(e.target.id, $('#message').val());
                        $('#messages').append(`<p>Me: ${$('#message').val()}</p>`)
                        $("#messages").scrollTop($("#messages")[0].scrollHeight);
                        $('#message').val('').focus();
                    });

                });
                
            });
        });


    </script>
}
